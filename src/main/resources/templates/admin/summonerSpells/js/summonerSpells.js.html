<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head></head>
<body>
<script th:fragment="script">
/*<![CDATA[*/
$(function() {
    $('#summoner-spells-difference').DataTable({
        order: [ [1, 'asc'] ],
        columnDefs: [
            { orderable: false, targets: [0, 2] },
            { searchable: false, targets: [0] }
        ],
        lengthMenu: [ [10, -1], [10, 'All'] ]
    });
    $('#save-summoner-spells-form').submit(function(event) {
        $.ajax({
            type: 'POST',
            url: [[@{/riot/summoner-spells}]],
            beforeSend: function() {
                $('#save-summoner-spells-btn').addClass('loading');
            },
            data: { truncate: $('#truncate').is(':checked'), _csrf: [[${_csrf.token}]] },
            success: function(data) {
                location.reload();
            }
        });
        event.preventDefault();
    });
    $('#summoner-spells').DataTable({
        processing: true,
        serverSide: true,
        order: [ [1, 'asc'] ],
        ajax: {
            url: [[@{/api/summoner-spells}]],
            dataSrc: function(data) {
                if (typeof data._embedded === 'undefined') {
                    return {};
                }
                return data._embedded.summonerSpells;
            },
            data: function(data) {
                var sorts = [];
                $.each(data.order, function (i, order) {
                    sorts.push(data.columns[order.column].data + "," + order.dir);
                });
                return { page: Math.ceil(data.start / data.length), size: data.length, sort: sorts[0] };
            }
        },
        columnDefs: [
            { orderable: false, targets: [0, 2, 3] },
            { searchable: false, targets: [0] }
        ],
        columns: [
            { data: 'image.full',
                render: function(data, type, full, meta) {
                    return '<img class="ui rounded image" style="height:60px;width:auto;" src="/resources/' + data + '" />';
                }
            },
            { data: 'name' },
            { data: 'modes[, ]' },
            { data: '_links.self.href',
                render: function(data, type, full, meta) {
                    var id = data.substring(data.lastIndexOf('/') + 1, data.length);
                    return '<button id="' + id + '" class="ui button">' + [[#{admin.summonerSpell.overwrite}]] +
                            '</button>';
                }
            }
        ],
        lengthMenu: [ [10, -1], [10, 'All'] ],
        infoCallback: function(settings, start, end, max, total, pre) {
            var json = this.api().ajax.json();
            if (typeof json._embedded === 'undefined') {
                $('#summoner-spells_paginate span').empty();
                return 'Showing 0 to 0 of 0 entries';
            }
            var page = this.api().ajax.json().page;
            end = (page.number + 1) * page.size;
            if (end > page.totalElements) {
                end = page.totalElements;
            }
            return 'Showing ' + start + ' to ' + end + ' of ' + json._embedded.summonerSpells.length +
                    ' entries (filtered from ' + page.totalElements + ' total entries)';
        },
        searching: false,
    });
    $('#summoner-spells tbody').on('click', 'button', function() {
        var overwriteBtn = $(this);
        $.ajax({
            type: 'POST',
            url: [[@{/riot/summoner-spells}]] + '/' + $(this).attr('id'),
            beforeSend: function() {
                overwriteBtn.addClass('loading');
            },
            data: { _csrf: [[${_csrf.token}]] },
            success: function(data) {
                location.reload();
            }
        });
    });
    $('#difference-msg').click(function() {
        $(this).transition('fade');
    });
});
/*]]>*/
</script>
</body>
</html>