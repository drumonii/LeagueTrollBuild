<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head></head>
<body>
<script th:inline="javascript" th:fragment="script">
/*<![CDATA[*/
$(function() {
    $('#map').dropdown();
    $('.message').click(function() {
        $(this).transition('fade');
    });
    var newBuildBtn = $('#new-build');
    newBuildBtn.popup({
        on: 'manual',
        inline: true
    });

    var trollBuild = function getTrollBuild() {
        $.ajax({
            url: /*[[@{/champions/__${champion.id}__/troll-build}]]*/ '/champions/1/troll-build',
            beforeSend: function() {
                newBuildBtn.addClass('loading');
                $('#build-segment').addClass('loading');
            },
            data: {
                mapId: $('#map option:selected').val()
            },
            success: function(data) {
                $('#champion-error-msg').hide();
                newBuildBtn.popup('hide');
                $.each(data, function(id, list) {
                    var html = [];
                    $.each(list, function(i, element) {
                        var img = element.image.full;
                        html.push(
                            $('<div>', {
                                class: 'item',
                                'data-html': '<h4>' + element.name + '</h4>' + element.description,
                                'data-variation': 'wide'
                            }).append($('<img>', {
                                class: 'ui rounded image',
                                src: '/img/' + $('#' + id).data('model') + '/' + element.id +
                                    img.substring(img.lastIndexOf('.'), img.length)
                            }))
                        );
                    });
                    $('#' + id).html(html);
                    $('#items .item, #summoner-spells .item, #trinket .item').popup();
                });
            },
            error: function() {
                $('#champion-error-msg .header').text(/*[[#{champion.trollBuild.error}]]*/ 'champion.trollBuild.error');
                $('#champion-error-msg').show();
            },
            complete: function() {
                newBuildBtn.removeClass('loading');
                $('#build-segment').removeClass('loading');
                // If map is Proving Grounds
                if ($('#map option:selected').val() == 12) {
                    $('#trinket .image').addClass('disabled');
                } else {
                    $('#trinket .image').removeClass('disabled');
                }
            }
        });
    }
    trollBuild();

    newBuildBtn.click(function() {
        trollBuild();
    });
    $('#map').change(function () {
        trollBuild();
    });
});
/*]]>*/
</script>
</body>
</html>