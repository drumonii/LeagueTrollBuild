<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head></head>
<body>
<script th:fragment="script">
/*<![CDATA[*/
$(function() {
    $('#map').dropdown();
    var newBuildBtn = $('#new-build');
    newBuildBtn.popup({
        on: 'manual',
        inline: true
    });

    getTrollBuild();
    function getTrollBuild() {
        $.ajax({
            url: [[@{/champions/__${champion.id}__/troll-build}]],
            beforeSend: function() {
                newBuildBtn.addClass('loading');
            },
            data: {
                mapId: $('#map option:selected').val()
            },
            success: function(data) {
                newBuildBtn.popup('hide');
                $.each(data, function(id, list) {
                    var html = [];
                    $.each(list, function(id, element) {
                        html.push(
                            $('<div>', {
                                class: 'item',
                                'data-html': '<h4>' + element.name + '</h4>' + element.description,
                                'data-variation': 'wide'
                            }).append($('<img>', {
                                class: 'ui rounded image',
                                src: '/resources/' + element.image.full
                            }))
                        );
                    });
                    $('#' + id).html(html);
                    $('#items .item, #summoner-spells .item, #trinket .item').popup();
                });
            },
            error: function() {
                newBuildBtn.popup('show');
            },
            complete: function() {
                newBuildBtn.removeClass('loading');
                // If map is Proving Grounds or Crystal Scar
                if ($('#map option:selected').val() == 12 || $('#map option:selected').val() == 8) {
                    $('#trinket .image').addClass('disabled');
                } else {
                    $('#trinket .image').removeClass('disabled');
                }
            }
        });
    }
    newBuildBtn.click(function() {
        getTrollBuild();
    });
    $('#map').change(function () {
        getTrollBuild();
    });
});
/*]]>*/
</script>
</body>
</html>